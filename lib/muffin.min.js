var exec=require("child_process").exec,fs=require("fs-extra"),path=require("path"),util=require("util"),wrench=require("wrench"),muffin={dir:{},file:{}};muffin.dir.read=function(a){if(!a.path)throw new Error;fs.readdir(a.path,function(b,c){a.ext&&(c=c.filter(function(b){var c=a.ext.length;return parseInt(c),c*=-1,b.substr(c)==a.ext})),c.forEach(function(a){})})},muffin.bake=function(a){var b=this,c=muffin.path.markx+" ";a.template&&(c=c+"--template "+muffin.path.called+a.template+" ");if(!a.input)throw new Error;c=c+muffin.path.called+a.input+" > ";if(!a.output)throw new Error;c=c+muffin.path.called+a.output,exec(c,function(a,b,c){console.log("stdout: "+b),console.log("stderr: "+c),a!==null&&console.log("exec error: "+a)})},muffin.init=function(a){var b=a.path||muffin.path.called,c={articles:b+"/articles",authors:b+"/authors",blog:b+"/public/blog","public":b+"/public",templates:b+"/templates"};[c.articles,c.authors,c.blog,c.public,c.templates].forEach(function(a){wrench.rmdirSyncRecursive(a,!0)}),[c.articles,c.authors,c.public,c.blog,c.templates].forEach(function(a){fs.mkdirSync(a)}),fs.copyFile(muffin.path.lib+"/default.json",b+"/authors/default.json",function(a){if(!!a)throw a;var c=b+"/package.json",d=path.existsSync(c);d&&fs.unlink(c),fs.copyFile(muffin.path.lib+"/package.json",c,function(a){if(a)throw a})})},module.exports=function(a){return muffin.path=a,muffin}