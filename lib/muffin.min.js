var exec=require("child_process").exec,fs=require("fs-extra"),path=require("path"),util=require("util"),wrench=require("wrench"),muffin={dir:{},file:{}};muffin.directories=function(a){var a=a||{},b=a.path||muffin.path.called;return{articles:b+"/articles",authors:b+"/authors",blog:b+"/public/blog","public":b+"/public",templates:b+"/templates"}},muffin.files=function(a){var a=a||{},b=a.libPath||muffin.path.lib,c=a.outputPath||muffin.path.called;return{authors:{"default":b+"/default.json",copy:c+"/authors/default.json"},content:{"default":b+"/default.md",copy:c+"/articles/default.md"},"package":{"default":b+"/package.json",copy:c+"/package.json"}}},muffin.bake=function(a){var b=this,c=muffin.path.markx+" ",d=a.inputPath||!1,e=a.outputPath||!1,f=a.templatePath||!1;f&&(c+="--template "+f+" ");if(!d)throw new Error;c+=d+" > ";if(!e)throw new Error;c+=e,exec(c,function(a,b,c){a!==null&&console.log("exec error: "+a)})},muffin.burn=function(a){var b=this,a=a||{},c=a.path||muffin.path.called,d=new muffin.directories({path:c});[d.articles,d.authors,d.blog,d.public,d.templates].forEach(function(a){wrench.rmdirSyncRecursive(a,!0)});var e=new muffin.files({path:c}),f=path.existsSync(e.package.copy);f&&fs.unlink(e.package.copy)},muffin.post=function(a){var b=this,a=a||{},c=a.outputPath||muffin.path.called,d=new muffin.files({outputPath:c});fs.copyFile(d.content.default,d.content.copy,function(a){if(a)throw a})},muffin.prepare=function(a){var b=this,a=a||{},c=a.libPath||muffin.path.lib,d=a.outputPath||muffin.path.called;muffin.burn({path:d});var e=new muffin.directories({path:d});[e.articles,e.authors,e.public,e.blog,e.templates].forEach(function(a){fs.mkdirSync(a)});var f=new muffin.files({libPath:c,outputPath:d});fs.copyFile(f.authors.default,f.authors.copy,function(a){if(!!a)throw a;fs.copyFile(f.package.default,f.package.copy,function(a){if(a)throw a})})},module.exports=function(a){return muffin.path=a,muffin};var getFilesByExt=function(a,b){if(!a.path)throw new Error;fs.readdir(a.path,function(c,d){a.ext&&(d=d.filter(function(b){var c=a.ext.length;return parseInt(c),c*=-1,b.substr(c)==a.ext})),typeof b=="function"&&b(d)})}